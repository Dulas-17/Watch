<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DULAS Encoder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(120deg, #4e54c8, #8f94fb);
      color: white;
      text-align: center;
      padding: 40px;
    }
    .container {
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 15px;
      display: inline-block;
      width: 400px;
    }
    input, select, button {
      margin: 8px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      width: 80%;
    }
    button {
      background: #00c6ff;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover { background: #0072ff; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ”’ DULAS Encoder</h1>
    <p>Choose what to encode:</p>
    <select id="fileType">
      <option value="image">Images</option>
      <option value="audio">Audio</option>
    </select>
    <br>
    <input type="file" id="fileInput" multiple>
    <br>
    <input type="password" id="password" placeholder="Optional password">
    <br>
    <button onclick="encodeFiles()">Encode to .dls</button>
    <div id="output"></div>
  </div>

  <script>
    function xorEncryptDecrypt(data, password) {
      let result = "";
      for (let i = 0; i < data.length; i++) {
        result += String.fromCharCode(
          data.charCodeAt(i) ^ password.charCodeAt(i % password.length)
        );
      }
      return result;
    }

    function encodeFiles() {
      const fileType = document.getElementById("fileType").value;
      const files = document.getElementById("fileInput").files;
      const password = document.getElementById("password").value;
      const output = document.getElementById("output");
      output.innerHTML = "";

      if (files.length === 0) {
        alert("Please select at least one file!");
        return;
      }
      if (files.length > 10) {
        alert("You can only select up to 10 files!");
        return;
      }

      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = () => {
          let base64 = reader.result;
          let finalContent = base64;

          if (password) {
            finalContent = btoa(xorEncryptDecrypt(base64, password));
          }

          const dlsData = {
            dulasVersion: "1.0",
            dulasType: fileType,
            fileName: file.name,
            fileSize: file.size,
            createdAt: new Date().toISOString(),
            passwordProtected: !!password,
            content: finalContent
          };

          const blob = new Blob([JSON.stringify(dlsData)], { type: "application/dulas" });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = file.name.split(".")[0] + ".dls";
          link.textContent = `â¬‡ Download ${link.download}`;
          output.appendChild(link);
          output.appendChild(document.createElement("br"));
        };
        reader.readAsDataURL(file);
      });
    }
  </script>
</body>
</html>